<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>3.1. makemore: Learning Rate</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+3:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
    body {
        font-size: 1.4em;
        font-family: 'Source Sans 3', 'Hoefler Text', Georgia, 'Times New Roman', Times, serif;
        max-width: 900px;
        margin: 1em auto 10em;
    }

    :focus {
        outline-width: 2px;
        outline-style: solid;
        outline-color: #00f;
        border-radius: 2px;
        border-color: transparent;
    }

    [aria-label] {
        position: relative;
    }

    [aria-label]:focus-within::before {
        content: attr(aria-label);
        position: absolute;
        bottom: -20px;
        font-size: 12px;
        /* right: 0; */
    }

    input, button {
        font-family: inherit;
        font-size: inherit;
        font-size: 0.8em;
    }

    pre, code, samp, textarea {
        font-family: 'Source Code Pro', ui-monospace, Menlo, Monaco, "Cascadia Mono", "Segoe UI Mono", "Roboto Mono", "Oxygen Mono", "Ubuntu Monospace", "Source Code Pro", "Fira Mono",  "Droid Sans Mono", "Courier New", monospace !important;
        font-size: 0.8em !important;
        background: lightgoldenrodyellow;
    }

    pre, textarea {
        overflow: auto;
        padding: 1em;
    }

    pre[data-error] {
        background: lightpink;
    }

    details {
        margin: 1em 0;
    }

    aside {
        background-color: lavender;
        padding: .5em .7em;
    }

    textarea {
        width: 100%;
        border: none;
        resize: none;
        text-wrap: nowrap;
    }

    /* nav {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        background: lightgoldenrodyellow;
        padding: 1em;
        overflow: auto;
    } */
</style>
<article>
<h1>3.1. makemore: Learning Rate</h1>

<h2 id="what-is-a-good-learning-rate">What is a good learning rate?</h2>

<p>Letâ€™s try to find a good learning rate between 0.001 and 1, which are likely to
be at the low and high end respectively. We could try some between,
exponentially trying a higher learning rate.</p>

<textarea disabled rows='8'>
function linspace(start, end, num) {
    const step = (end - start) / (num - 1);
    return Array.from({ length: num }, (_, i) => start + (step * i));
}
export const learningRateExponents = linspace( -3, 0, 1000 );
export const learningRates = learningRateExponents.map( ( exponent ) => Math.pow( 10, exponent ) );
export const graph = document.createElement( 'div' );
</textarea>

<p>Important: we should reset the parameters!</p>

<textarea disabled rows='4'>
resetParams();
export const losses = [];
export const loss = await lossFn( X, Y );
</textarea>

<textarea disabled rows='30' data-iterations="1000">
const indices = Int32Array.from( { length: hyperParameters.batchSize }, () => Math.random() * X.shape[ 0 ] );
indices.shape = [ indices.length ];
const Xbatch = gather( X, indices );
const Ybatch = gather( Y, indices );
const loss = await lossFn( Xbatch, Ybatch );
losses.push( loss.data );
await loss.backward();
for ( const param of params ) {
    for ( let i = param.data.length; i--; ) {
        param.data[ i ] -= learningRates[ losses.length ] * param.grad[ i ];
    }
}

await Plotly.react(graph, [{
    x: [...learningRateExponents],
    y: [...losses],
}], {
    title: 'Loss vs Learning Rate',
    xaxis: {
        title: 'Learning Rate Exponent',
    },
    yaxis: {
        title: 'Loss',

    },
    width: 500,
    height: 500
});
export default graph;
</textarea>

<p>The learning rate of 0.1 looks good, where 0.001 looks way too low, and 1 makes
the loss explode.</p>

<p>To do: learning rate diagnostic end of part 3 video: https://www.youtube.com/watch?v=P6sfmUTpUmc.</p>

</article>
<script src="lib/acorn.min.js"></script>
<script src="common.js"></script>
<link rel="stylesheet" href="lib/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="lib/codemirror.min.js" integrity="sha512-8RnEqURPUc5aqFEN04aQEiPlSAdE0jlFS/9iGgUyNtwFnSKCXhmB6ZTNl7LnDtDWKabJIASzXrzD0K+LYexU9g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="lib/javascript.min.js" integrity="sha512-I6CdJdruzGtvDyvdO4YsiAq+pkWf2efgd1ZUSK2FnM/u2VuRASPC7GowWQrWyjxCZn6CT89s3ddGI+be0Ak9Fg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<style>
    .CodeMirror, .CodeMirror-scroll {
        height: auto;
        background: none;
    }
</style>
<script>
    document.querySelectorAll('textarea').forEach((textarea) => {
        textarea.editor = CodeMirror.fromTextArea(textarea, {
            mode: 'javascript',
            viewportMargin: Infinity,
            // theme: 'material',
            extraKeys: {
                'Shift-Enter': (cm) => {
                    textarea.button.focus();
                },
            },
        });
    })
</script>







  <a href="makemore-MLP">Previous: 3. makemore: MLP</a>


<!-- Debug: 
    Original: /makemore-initialisation
    After remove_first: makemore-initialisation
    After relative_url: /makemore-initialisation
  -->
  <a href="makemore-initialisation">Next: 3.2. makemore: Initialisation</a>

<nav>
    <!-- <details> -->
        <!-- <summary>Table of contents</summary> -->
        <ul>
            
            <li><a href="">1. makemore: bigram</a></li>
            
            <li><a href="autograd">2. Autograd</a></li>
            
            <li><a href="makemore-MLP">3. makemore: MLP</a></li>
            
            <li><a href="makemore-learning-rate">3.1. makemore: Learning Rate</a></li>
            
            <li><a href="makemore-initialisation">3.2. makemore: Initialisation</a></li>
            
            <li><a href="makemore-batch-norm">3.3. makemore: Batch Norm</a></li>
            
            <li><a href="makemore-layer-organisation">3.4. makemore: Layer Organisation</a></li>
            
            <li><a href="diagnostic-tools">3.5. Diagnostic Tools</a></li>
            
            <li><a href="backprop-ninja">4. Backprop Ninja</a></li>
            
            <li><a href="makemore-wavenet">5. makemore: WaveNet</a></li>
            
            <li><a href="transformer">6. Transformer</a></li>
            
        </ul>
    <!-- </details> -->
</nav>
<script async src="lib/tex-mml-chtml.js"></script>
